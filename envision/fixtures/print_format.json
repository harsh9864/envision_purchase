[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": ".print-format .table-bordered,\n.print-format .table-bordered > thead > tr > th,\n.print-format .table-bordered > tbody > tr > th,\n.print-format .table-bordered > tfoot > tr > th,\n.print-format .table-bordered > thead > tr > td,\n.print-format .table-bordered > tbody > tr > td,\n.print-format .table-bordered > tfoot > tr > td {\n\tborder: 1px solid black;\n}\n.print-format td, .print-format th {\n    vertical-align: top !important;\n    padding: 2px !important;\n}\n",
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Supplier Quotation",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<html>\n    <body>\n       <center> <h3>Recommendation Sheet</h3> </center>\n        {% if doc.workflow_state != \"Prepared\" %}\n        {% set currency_symbol = frappe.db.get_value(\"Currency\",doc.currency,'symbol') %}\n{% set a = namespace(initial_amount=0, initial_amount_tax=0) %} \n{% set b = namespace(budget_name='', budget_amount=0, gst_rate=0, budget_total=0, purchase_total=0, budget_item='',supplier_qut_amt=[], budget_sum = 0) %}\n{% set displayed_groups = [] %}\n{% set displayed_items = [] %}\n{% set displayed_amt = [] %}\n                     \n<table class=\"table-bordered\" style=\"page-break-after:always\"> \n<tr> \n<td colspan=\"5\">\n<center>\n<h4>{{ doc.company }}</h4>\n</center>\n</td> \n</tr> \n<tr> \n<td colspan=\"2\" class=\"text-right\">\n<b>Client</b>\n</td>\n <td colspan=\"3\">\n {{ frappe.db.get_value(\"Project\",doc.project,\"customer\") or ''}}\n </td>\n  </tr> \n  <tr> \n  <td colspan=\"2\" class=\"text-right\">\n  <b>Project</b>\n  </td> \n  <td colspan=\"3\">\n  {{ frappe.db.get_value(\"Project\",doc.project,\"project_name\") }}\n  </td> \n  </tr> \n  <tr> \n  <td colspan=\"2\" class=\"text-right\">\n  <b>TITLE</b>\n  </td> \n  <td colspan=\"3\">{{ doc.custom_title or ' ' }}</td> \n  </tr>\n   <tr> \n   <td colspan=\"2\" class=\"text-right\"><b>Project No.</b></td> \n   <td>{{ doc.project }}</td> \n   <td class=\"text-right\"><b>REVISION NO</b></td>\n    <td>0</td>\n     </tr> \n     <tr> \n     <td colspan=\"2\" class=\"text-right\"><b>DOCUMENT NO</b></td>\n      <td>{{ doc.name }}</td>\n       <td class=\"text-right\"><b>DATE</b></td>\n        <td>{{ doc.get_formatted('transaction_date') }}</td> \n        </tr>\n        <tr> \n        <td colspan=\"5\"></td> \n        </tr>\n         <tr> \n         <th style=\"text-align:center;\">Sr.No</th>\n         <th colspan=\"2\" style=\"width:60%;text-align:center;font-size:16px\">Details/Query </th>\n          <th>Answers </th> \n          <th>Remarks </th> \n          </tr> \n          <tr>\n           <td style=\"text-align:center;\"><b>a</b></td> \n           <td><b>Recommended Vendor</b></td>\n         <td>\n    {% set rfq_doc = frappe.get_doc(\"Request for Quotation\", doc.custom_request_for_quotation) %}\n    {% for supplier in rfq_doc.suppliers %}\n        {{ supplier.supplier_name }}, <!-- Adjust the field name as per your child table fields -->\n    {% endfor %}\n</td>\n\n             <td><b> {{ doc.supplier_name }} </b></td>\n             <td></td>\n              </tr> \n              <tr> \n              <td rowspan=\"3\" style=\"text-align:center;\">\n              <b>b</b>\n              </td>\n               <td rowspan=\"3\"><b>Initial Offer Amount (Recommended Vendor)</b></td>\n                <td>Basic Cost </td> \n                <td class=\"text-right\">{{ currency_symbol }} {% for item in doc.items %} {% set a.initial_amount = a.initial_amount +  (item.custom_supplier_rate * item.qty ) %} {% endfor %} {{ a.initial_amount or 0 }}<b>\n                </b></td> <td></td> \n                </tr> \n                <tr> \n                <td>Tax </td> \n                <td class=\"text-right\">{{ currency_symbol }} {% for item in doc.items %} {% set a.initial_amount_tax = a.initial_amount_tax +  (frappe.db.get_value(\"Item Tax Template\", item.item_tax_template, \"gst_rate\") or 0) * item.custom_supplier_rate/100 %} {% endfor %}  {{ a.initial_amount_tax }}\n</td> \n                <td>\n</td> \n                </tr> \n                <tr> \n                <td><b>Total </b></td> \n                <td class=\"text-right\"><b><b>\n               {{ currency_symbol }} {{   a.initial_amount + a.initial_amount_tax  }} </b></b></td> \n                <td></td> \n                </tr> \n               <tr> \n        <td rowspan=\"2\" style=\"text-align:center;\"><b>c</b></td> \n        <td rowspan=\"2\"><b>Is recommended Vendor amount the lowest compared to others?</b></td>\n        <td>Yes / No</td>\n    \n          {% set supplier_qut_amt_base = frappe.db.get_all(\"Supplier Quotation\",\n    filters={\"custom_request_for_quotation\": doc.custom_request_for_quotation},\n    fields=[\"name\", \"grand_total\"]\n) %}\n\n{% set low = namespace(lowest_total=None, is_lowest=True) %}\n{% set displayed_items = [] %}\n\n<!-- Append grand_total values to displayed_items list -->\n{% for lowest in supplier_qut_amt_base %}\n    {% if doc.name != lowest.name %}\n        {% set _ = displayed_items.append(lowest.grand_total) %}\n        {% if low.lowest_total is none or lowest.grand_total < low.lowest_total %}\n            {% set low.lowest_total = lowest.grand_total %}\n        {% endif %}\n    {% endif %}\n{% endfor %}\n\n<!-- Check if the recommended vendor has the lowest quotation -->\n<td class=\"text-center\">\n    {% set recommended_vendor_total = doc.grand_total or 0 %}\n\n    {% if low.lowest_total and recommended_vendor_total > 0 %}\n        {{ \"Yes\" if recommended_vendor_total <= low.lowest_total else \"No\" }}\n    {% else %}\n        No\n    {% endif %}\n</td>\n        \n        <td></td> \n    </tr> \n                   <tr> \n                   <td>If No, reason for higher quotation Refer Remarks.</td> \n                   <td><b></b></td>\n                    <td></td>\n                     </tr>\n                      <tr> \n                    \n                       \n                    {% for item in doc.items %}  {% set b.gst_rate = (frappe.db.get_value(\"Item Tax Template\", item.item_tax_template, \"gst_rate\") or 0)  %} {% endfor %}\n                      <td  style=\"text-align:center;\"><b>d</b></td>\n                      \n    <td><b>Budget amount</b></td>\n    <td>Remaining Budget</td>\n    <td class=\"text-right\">\n        \n        <!-- Get the budget name -->\n        {% set b.budget_name = frappe.db.get_value(\"Project Budget\", {'company': doc.company, 'project': doc.project, 'department': doc.custom_department}, 'name') %}\n\n        <!-- Fetch and display budget items only once per item group -->\n        {% for item in doc.items %}\n            {% set budget_items = frappe.db.get_all(\"Budget Items\",\n                                                     filters={'parent': b.budget_name},\n                                                     fields=['*']) %}\n\n            {% for budget_item in budget_items %}\n                {% if budget_item.apply_budget_on == \"Item Group\" and item.item_group == budget_item.item and budget_item.item not in displayed_groups %}\n                     {% set b.budget_item = b.budget_item + (', ' if b.budget_item else '') + budget_item.current_budget|string %}\n                    {% set b.budget_sum = b.budget_sum + budget_item.current_budget|float %}\n                    {% set _ = displayed_groups.append(budget_item.item) %}\n                 {% elif budget_item.apply_budget_on == \"Item\" and item.item_code == budget_item.item and budget_item.item not in displayed_items %}\n                     {% set b.budget_item = b.budget_item + (', ' if b.budget_item else '') + budget_item.current_budget|string %}\n                    {% set b.budget_sum = b.budget_sum + budget_item.current_budget|float %}\n                    {% set _ = displayed_items.append(budget_item.item) %}\n              \n                {% endif %}\n            {% endfor %}\n        {% endfor %}\n        <b>{{ b.budget_sum }}</b>\n    </td>\n<td></td>\n </tr> \n \n \n <tr> \n <td rowspan=\"3\" style=\"text-align:center;\"><b>e</b></td> \n\n <td rowspan=\"3\"><b>Purchase order value </b></td> \n <td>Basic Cost</td> <td class=\"text-right\"> {{ currency_symbol }} {{ doc.total or 0 }} </td> \n <td></td>\n  </tr>\n   <tr>\n    <td>Tax</td> \n    <td class=\"text-right\">{{ currency_symbol }} {{ doc.taxes_and_charges_added or 0  }}</td>\n     <td></td>\n      </tr>\n       <tr> \n       <td><b>Total </b></td> \n       <td class=\"text-right\" style=\"font-weight:bold\">{{ currency_symbol }} {{ doc.grand_total or 0 }}</b></b></td> \n        <td></td>\n         </tr>\n          <tr>\n           <td rowspan=\"2\" style=\"text-align:center;\"><b>f</b></td>\n            <td rowspan=\"2\"><b>Is Actual cost under the budget</b></td>\n             <td>Yes/ No</td>\n              <td style=\"text-align:center\">{% if doc.grand_total < b.budget_sum|float %}\n              Yes \n              {% else %} No {% endif %}</td>\n               <td></td>\n               </tr> \n               <tr> \n               <td>If No, Refer Remarks. </td> \n               <td></td> \n               <td></td>\n                </tr>\n                 <tr> \n                 <td style=\"text-align:center;\"><b>g</b></td> \n                 <td><b>Additional Cost </b></td> \n                 <td></td> \n                 <td></td> \n                 <td></td>\n                  </tr> \n                  {% set num = 0 %}\n                  {% for item in doc.taxes %}\n                  {% if item.included_in_print_rate == 1 %}\n<tr> \n          <td style=\"text-align:center;\">{{ num + 1 }}</td>\n           <td>{{ item.description or ' '  }}</td>\n            <td></td> \n            <td>Inclusive</td>\n             <td></td> \n             </tr>         \n             {% endif %}\n             {% endfor %}                                          \n\n<tr> \n<td rowspan=\"1\" style=\"text-align:center;\"><b>h</b></td>\n<td rowspan=\"\"><b>Is scope of supply in accordance with PO/WO by client?</b></td>\n<td colspan=\"2\">Please Refer Remarks, If Scope Of Supply Is Not In Accordance With PO/Wo By Client.</td>\n\n<td></td> \n</tr>\n\n\n \n\n\n<tr> \n<td style=\"text-align:center;\"><b>j</b></td>\n<td colspan=\"1\"><b>Payment Terms </b></td>\n<td> {{ doc.custom_payment_terms or '' }}</td>\n<td></td>\n<td></td>\n</tr>\n<tr> \n<td style=\"text-align:center;\"><b>k</b></td> \n<td colspan=\"1\"><b>Delivery Period </b></td> \n<td>{{ doc.custom_delivery_terms or '' }}</td>\n<td></td>\n<td></td>\n</tr>\n<tr> \n<td rowspan=\"1\" style=\"text-align:center;\">1</td>\n<td rowspan=\"1\">Is the delivery period accordance to the execution schedule ?</td>\n <td colspan=\"2\">Please Refer Remarks, If the delivery Period Is not Accordance To The Executation Schedule.</td>\n  \n   <td></td> \n   </tr> \n  <tr>\n      <td></td>\n      <td><b><center>Submitted By</center></b></td>\n      <td><b><center>Reviwed By</center></b> </td>\n      <td colspan=\"2\"><b><center>Approved By</center></b></td>\n  </tr>\n  <tr>\n  <td>Sign</td>\n  <td>\n    <center>\n      {% set submit_name = frappe.db.get_value(\"Comment\", {\"comment_type\": \"Workflow\", \"reference_name\": doc.name, \"content\": \"Submitted\"}, \"comment_email\") %}\n      {{ frappe.db.get_value(\"User\",submit_name,\"full_name\") }}\n    </center>\n  </td>\n  <td><center> {% set review_name = frappe.db.get_value(\"Comment\", {\"comment_type\": \"Workflow\", \"reference_name\": doc.name, \"content\": \"Reviewed\"}, \"comment_email\") %}\n      {{ frappe.db.get_value(\"User\",review_name,\"full_name\") }}</center></td>\n  <td colspan=\"2\"><center>{% set approve_name = frappe.db.get_value(\"Comment\", {\"comment_type\": \"Workflow\", \"reference_name\": doc.name, \"content\": \"Approved\"}, \"comment_email\") %}\n      {{ frappe.db.get_value(\"User\",approve_name,\"full_name\") }}</center></td>\n</tr>\n\n    \n              </table> \n                                                                                              \n{% endif %}\n    </body>\n</html>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-10 13:05:55.538449",
  "module": "Envision",
  "name": "RECOMMENDED",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]